flowchart LR
    A("Step 1: Get Niche") -- CronJob Call Lambda every hour --> B[["Niche Lambda"]]
    B -- Add Query to Queue --> C{"Niche SQS Check the Queue"}
    C -- Queue Empty? --> D[["Process Niche Queue"]]
    D -- Queue is being processed --> B
    B -- Get list of niches --> E("Gemini AI")
    E -- Get Results --> F{"Lambda Processor"}
    F -- First Time? --> Q[["Lambda Settler"]]
    Q -- Save Brand New File to Bucket --> H[("Niche S3 Bucket")]
    Q -- Create Niche Repo --> I[["Github"]]
    Q -- Commit file to Repo --> I
    H -- Commit file to Repo --> I
    I -- Publish Event to Niche SNS --> T[["Niche SNS Topic"]]
    T -- Lambda Settler is subscribe to topic --> Q
    Q -- Add Niche/s to Database --> K[("Niche DynamoDB")]
    Q -- Publish Notifications --> T
    T -- Notify - File Created --> L[/"Marketeer"\]
    Q -- Trigger Step 2 --> M((("End Step 1")))
    F -- else --> N[["Lambda Parser"]]
    N -- Create Branch --> I
    N -- Save File to Bucket with New Niche --> H
    N -- Commit File to Branch --> I
    H -- Commit File to Branch --> I
    N -- Parser Review Results --> O{"Lambda Reviewer"}
    O -- New Niche? --> R>"Notify Marketeer"]
    R --> T
    T -- Notify- New Niches to Review --> L
    L -- Review Results --> I
    I -- Validate Results --> S{"Accept Results"}
    S --> L
    L -- Merge Branch --> I
    I -- Github Actions call Parser --> N
    N -- Add Niche to Database --> K
    N -- Trigger Step 2 --> M
    M -- Process Next Item in Niche Queue --> D
    style A stroke:#00C853,fill:#00C853,color:#FFFFFF
    style B fill:#FF6D00,color:#FFFFFF,stroke-width:2px,stroke-dasharray: 2,stroke:#000000
    style C fill:#D50000,color:#FFFFFF,stroke-width:4px,stroke-dasharray: 5,stroke:#000000
    style D color:#000000,fill:#FFD600,stroke-width:2px,stroke-dasharray: 2,stroke:#000000
    style E fill:#2962FF,color:#FFFFFF
    style F color:#FFFFFF,fill:#D50000,stroke-width:4px,stroke-dasharray: 5,stroke:#000000
    style Q fill:#FFD600,color:#FFFFFF,stroke-width:2px,stroke-dasharray: 2,stroke:#000000
    style H stroke:#000000,fill:#BBDEFB,color:#424242
    style I stroke-width:1px,stroke-dasharray: 0,fill:#000000,color:#FFFFFF
    style T stroke-width:2px,stroke-dasharray: 2,stroke:#000000,fill:#FFD600
    style K stroke:#000000,fill:#BBDEFB
    style L stroke-width:4px,stroke-dasharray: 5,stroke:#000000,fill:#FF6D00
    style M stroke:#000000,fill:#00C853
    style N fill:#FFD600,stroke:#000000,stroke-width:2px,stroke-dasharray: 2
    style O stroke-width:4px,stroke-dasharray: 5,fill:#D50000,stroke:#000000,color:#FFFFFF
    style R fill:#FFE0B2,stroke:#000000
    style S stroke:#000000,color:#FFFFFF,fill:#D50000,stroke-width:4px,stroke-dasharray: 5